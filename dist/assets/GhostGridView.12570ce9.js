import{d as v,u as k,H as c,_ as y,o as V,c as T,a as x,w as S,v as D,b as r,V as f,f as o,j as R,k as w,l as _,m as C,n as P,p as A,q as u,r as $,e as H,g as U,h as I,i as M}from"./index.5d7d57f7.js";import{c as b,S as n,T as G,L as p,A as z,d as B}from"./remote-helpers.bf54a892.js";import{g as L,s as N,I as g,c as E,a as F}from"./stop.8f448c76.js";var K="/assets/car-ghost.47e983da.png",O="/assets/grid2.acd1483f.png";const j=v({name:"GhostGrid",setup(){const t=k();return t.sequentialMode=!0,t.clearCommands(),{carRemoteUrl:b,goalUrl:L,stopUrl:N,legoHubStore:t,HUB_COMMANDS:c}},data(){return{resizeInterval:null,gridNumber:2,reachedGoal:0,pixiApp:null,grid:new n(G.EMPTY),carRemote:{sprite:new n(G.EMPTY),gridPosition:[0,2],rotation:90},carGhost:{sprite:new n(G.EMPTY),gridPosition:[0,2],rotation:90},crashDialog:!1,goalDialog:!1}},created(){this.legoHubStore.$subscribe((t,i)=>{if(i.commands.length<1){const e=[[...this.carGhost.gridPosition].slice()[0],[...this.carGhost.gridPosition].slice()[1]];let s=[0,0];this.gridNumber==2&&(s=[...m].slice()[m.length-1]),console.log("curPos",e,"goalPos",s),e[0]==s[0]&&e[1]==s[1]&&this.goal();let h=[0,0];this.gridNumber==2&&(h=[...m].slice()[0]),this.carGhost.gridPosition=[h.slice()[0],h.slice()[1]],this.carRemote.rotation=90,this.carGhost.rotation=90}})},mounted(){this.initPixi(),this.resizeInterval=setInterval(()=>{var t;(t=this.pixiApp)==null||t.resize()},2e3)},unmounted(){var t,i,e;(t=p.shared.resources.grid.texture)==null||t.destroy(!0),(i=p.shared.resources.carRemote.texture)==null||i.destroy(!0),p.shared.reset(),this.carRemote.sprite.destroy(!0),(e=this.pixiApp)==null||e.destroy(!0),this.resizeInterval&&clearInterval(this.resizeInterval)},methods:{tick(){const t=Math.min(this.pixiApp.renderer.width/(this.grid.texture.baseTexture.width*6/5),this.pixiApp.renderer.height/this.grid.texture.baseTexture.height);this.grid.width=this.grid.texture.width*t,this.grid.height=this.grid.texture.height*t;const i=Math.min(this.grid.width/5/this.carGhost.sprite.texture.baseTexture.width,this.grid.height/3/this.carGhost.sprite.texture.baseTexture.height),e=Math.min(this.grid.width/5/this.carRemote.sprite.texture.baseTexture.width,this.grid.height/3/this.carRemote.sprite.texture.baseTexture.height);this.carGhost.sprite.width=this.carGhost.sprite.texture.width*i,this.carGhost.sprite.height=this.carGhost.sprite.texture.height*i,this.carRemote.sprite.width=this.carRemote.sprite.texture.width*e,this.carRemote.sprite.height=this.carRemote.sprite.texture.height*e;const s=this.grid.width/5;this.grid.x=s,this.carRemote.sprite.x=s/2,this.carRemote.sprite.y=s+s/2;const h=s/2,l=h+(this.carGhost.gridPosition[0]+1)*s,a=h+this.carGhost.gridPosition[1]*s,d=4;this.carGhost.sprite.x<l?(this.carGhost.sprite.x+=d,this.carGhost.sprite.x>l&&(this.carGhost.sprite.x=l)):this.carGhost.sprite.x>l&&(this.carGhost.sprite.x-=d,this.carGhost.sprite.x<l&&(this.carGhost.sprite.x=l)),this.carGhost.sprite.y<a?(this.carGhost.sprite.y+=d,this.carGhost.sprite.y>a&&(this.carGhost.sprite.y=a)):this.carGhost.sprite.y>a&&(this.carGhost.sprite.y-=d,this.carGhost.sprite.y<a&&(this.carGhost.sprite.y=a)),this.carGhost.rotation=this.carRemote.rotation,this.carRemote.sprite.angle<this.carRemote.rotation?(this.carRemote.sprite.angle+=2,this.carRemote.sprite.angle>=this.carRemote.rotation&&(this.carRemote.sprite.angle=this.carRemote.rotation)):this.carRemote.sprite.angle>this.carRemote.rotation&&(this.carRemote.sprite.angle-=2,this.carRemote.sprite.angle<=this.carRemote.rotation&&(this.carRemote.sprite.angle=this.carRemote.rotation)),this.carGhost.sprite.angle=this.carRemote.sprite.angle},initPixi(){const t=this.$refs.gridContainer;this.pixiApp=new z({resizeTo:this.$refs.gridContainer,backgroundAlpha:0}),t.appendChild(this.pixiApp.view),p.shared.add("grid",O).add("carRemote",b).add("carGhost",K).load((i,e)=>{this.grid=new n(e.grid.texture),this.pixiApp.stage.addChild(this.grid);const s=Math.min(this.pixiApp.renderer.width/6,this.pixiApp.renderer.height/3);this.grid.x=s,this.carGhost.sprite=new n(e.carGhost.texture),this.carGhost.sprite.alpha=.75,this.carGhost.sprite.anchor.set(.5),this.carGhost.sprite.x=s+s/2,this.carGhost.sprite.y=s*this.carGhost.gridPosition[1]+s/2,this.carGhost.sprite.angle=this.carGhost.rotation,this.carRemote.sprite=new n(e.carRemote.texture),this.carRemote.sprite.anchor.set(.5),this.carRemote.sprite.x=s/2,this.carRemote.sprite.y=s+s/2,this.carRemote.sprite.angle=this.carRemote.rotation,this.carRemote.sprite.interactive=!0,this.carRemote.sprite.on("mousedown",this.handleClick),this.carRemote.sprite.on("touchstart",this.handleClick),this.pixiApp.stage.addChild(this.carGhost.sprite),this.pixiApp.stage.addChild(this.carRemote.sprite),this.pixiApp.ticker.add(this.tick)}),g.add("crash",E),g.add("cheer",F)},crash(){console.error("CRASH"),g.play("crash"),this.crashDialog=!0,this.legoHubStore.clearCommands()},goal(){console.log("GOAL"),g.play("cheer"),this.goalDialog=!0,this.reachedGoal++},handleClick(t){const i=B(t.data.global,this.carRemote);let e=this.carRemote.rotation;for(;e<0;)e+=360;e=e%360,i&&i==c.FORWARD?(this.legoHubStore.addCommand({cmd:c.FORWARD,rotationContext:this.carRemote.rotation}),e==0?this.carGhost.gridPosition[1]--:e==90?this.carGhost.gridPosition[0]++:e==180?this.carGhost.gridPosition[1]++:e==270&&this.carGhost.gridPosition[0]--):i&&i==c.BACKWARD?(this.legoHubStore.addCommand({cmd:c.BACKWARD,rotationContext:this.carRemote.rotation}),e==0?this.carGhost.gridPosition[1]++:e==90?this.carGhost.gridPosition[0]--:e==180?this.carGhost.gridPosition[1]--:e==270&&this.carGhost.gridPosition[0]++):i&&i==c.LEFT?(this.legoHubStore.addCommand({cmd:c.LEFT,rotationContext:this.carRemote.rotation}),this.carRemote.rotation-=90):i&&i==c.RIGHT?(this.legoHubStore.addCommand({cmd:c.RIGHT,rotationContext:this.carRemote.rotation}),this.carRemote.rotation+=90):console.log("not detected");const s=[[...this.carGhost.gridPosition].slice()[0],[...this.carGhost.gridPosition].slice()[1]];let h=[];this.gridNumber==2&&(h=[...m].slice()),h.some(l=>l[0]===s[0]&&l[1]===s[1])||this.crash()}}}),m=[[0,2],[1,2],[1,1],[1,0],[2,0],[3,0],[3,1],[3,2],[4,2]],W={class:"h-100 w-100 d-flex flex-row justify-center align-center"},Y={class:"h-100 w-100 flex-grow-1",ref:"gridContainer"},q={class:"flex-grow-0"},X=u("\xC5h nej! K\xF8re-Karl k\xF8rte galt!"),J=u("Luk"),Q=u("K\xF8re-Karl kom i m\xE5l!"),Z=u("Luk");function tt(t,i,e,s,h,l){return V(),T("div",W,[x("div",Y,null,512),x("div",q,[S(r(f,{color:"primary",icon:"mdi-chevron-right",size:"x-large",to:"/sequential-remote"},null,512),[[D,t.reachedGoal>0]])]),r(A,{modelValue:t.crashDialog,"onUpdate:modelValue":i[1]||(i[1]=a=>t.crashDialog=a)},{default:o(()=>[r(R,null,{default:o(()=>[r(w,null,{default:o(()=>[X]),_:1}),r(_,null,{default:o(()=>[r(C,{src:t.stopUrl},null,8,["src"])]),_:1}),r(P,null,{default:o(()=>[r(f,{color:"primary",block:"",onClick:i[0]||(i[0]=a=>t.crashDialog=!1)},{default:o(()=>[J]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(A,{modelValue:t.goalDialog,"onUpdate:modelValue":i[3]||(i[3]=a=>t.goalDialog=a)},{default:o(()=>[r(R,null,{default:o(()=>[r(w,null,{default:o(()=>[Q]),_:1}),r(_,null,{default:o(()=>[r(C,{src:t.goalUrl},null,8,["src"])]),_:1}),r(P,null,{default:o(()=>[r(f,{color:"primary",block:"",onClick:i[2]||(i[2]=a=>t.goalDialog=!1)},{default:o(()=>[Z]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var et=y(j,[["render",tt]]);const it=v({name:"GhostGridView",components:{GhostGrid:et}});function st(t,i,e,s,h,l){const a=$("ghost-grid");return V(),H(U,{class:"h-100"},{default:o(()=>[r(I,{class:"h-100"},{default:o(()=>[r(M,{class:"h-100 d-flex justify-center align-center",cols:"12"},{default:o(()=>[r(a)]),_:1})]),_:1})]),_:1})}var ht=y(it,[["render",st]]);export{ht as default};

import{d as V,u as S,H as n,_ as b,o as k,c as T,a as x,w as $,v as G,b as r,V as R,f as o,j as _,k as C,l as w,m as A,n as v,p as y,q as g,r as H,e as U,g as z,h as I,i as B}from"./index.5d7d57f7.js";import{c as D,S as c,T as P,L as d,A as L,d as N}from"./remote-helpers.bf54a892.js";import{g as F,s as M,I as m,c as E,a as K}from"./stop.8f448c76.js";var O="/assets/grid1.14003500.png";const j=V({name:"DirectGrid",setup(){const e=S();return e.sequentialMode=!1,e.clearCommands(),{carRemoteUrl:D,goalUrl:F,stopUrl:M,legoHubStore:e,HUB_COMMANDS:n}},data(){return{resizeInterval:null,gridNumber:1,reachedGoal:0,pixiApp:null,grid:new c(P.EMPTY),carRemote:{sprite:new c(P.EMPTY),gridPosition:[0,0],rotation:90},crashDialog:!1,goalDialog:!1}},mounted(){this.initPixi(),this.resizeInterval=setInterval(()=>{var e;(e=this.pixiApp)==null||e.resize()},2e3)},unmounted(){var e,t,i;(e=d.shared.resources.grid.texture)==null||e.destroy(!0),(t=d.shared.resources.carRemote.texture)==null||t.destroy(!0),d.shared.reset(),this.carRemote.sprite.destroy(!0),(i=this.pixiApp)==null||i.destroy(!0),this.resizeInterval&&clearInterval(this.resizeInterval)},methods:{tick(){const e=Math.min(this.pixiApp.renderer.width/this.grid.texture.baseTexture.width,this.pixiApp.renderer.height/this.grid.texture.baseTexture.height);this.grid.width=this.grid.texture.width*e,this.grid.height=this.grid.texture.height*e;const t=Math.min(this.grid.width/5/this.carRemote.sprite.texture.baseTexture.width,this.grid.height/3/this.carRemote.sprite.texture.baseTexture.height);this.carRemote.sprite.width=this.carRemote.sprite.texture.width*t,this.carRemote.sprite.height=this.carRemote.sprite.texture.height*t;const i=this.grid.width/5,h=i/2,s=h+this.carRemote.gridPosition[0]*i,a=h+this.carRemote.gridPosition[1]*i,l=4;if(this.carRemote.sprite.x<s?(this.carRemote.sprite.x+=l,this.carRemote.sprite.x>s&&(this.carRemote.sprite.x=s)):this.carRemote.sprite.x>s&&(this.carRemote.sprite.x-=l,this.carRemote.sprite.x<s&&(this.carRemote.sprite.x=s)),this.carRemote.sprite.y<a?(this.carRemote.sprite.y+=l,this.carRemote.sprite.y>a&&(this.carRemote.sprite.y=a)):this.carRemote.sprite.y>a&&(this.carRemote.sprite.y-=l,this.carRemote.sprite.y<a&&(this.carRemote.sprite.y=a)),this.carRemote.sprite.angle<this.carRemote.rotation?(this.carRemote.sprite.angle+=2,this.carRemote.sprite.angle>=this.carRemote.rotation&&(this.carRemote.sprite.angle=this.carRemote.rotation)):this.carRemote.sprite.angle>this.carRemote.rotation&&(this.carRemote.sprite.angle-=2,this.carRemote.sprite.angle<=this.carRemote.rotation&&(this.carRemote.sprite.angle=this.carRemote.rotation)),this.reachedGoal>0||this.carRemote.sprite.x!=s||this.carRemote.sprite.y!=a)return;const f=this.carRemote.gridPosition;let u=[0,0];this.gridNumber==1&&(u=p[p.length-1]),f[0]==u[0]&&f[1]==u[1]&&this.goal()},initPixi(){const e=this.$refs.gridContainer;this.pixiApp=new L({resizeTo:this.$refs.gridContainer,backgroundAlpha:0}),e.appendChild(this.pixiApp.view),d.shared.add("grid",O).add("carRemote",D).load((t,i)=>{this.grid=new c(i.grid.texture),this.pixiApp.stage.addChild(this.grid);const s=this.pixiApp.renderer.width/5/2;this.carRemote.sprite=new c(i.carRemote.texture),this.carRemote.sprite.anchor.set(.5),this.carRemote.sprite.x=s,this.carRemote.sprite.y=s,this.carRemote.sprite.angle=this.carRemote.rotation,this.carRemote.sprite.interactive=!0,this.carRemote.sprite.on("mousedown",this.handleClick),this.carRemote.sprite.on("touchstart",this.handleClick),this.pixiApp.stage.addChild(this.carRemote.sprite),this.pixiApp.ticker.add(this.tick)}),m.add("crash",E),m.add("cheer",K)},crash(){console.error("CRASH"),m.play("crash"),this.crashDialog=!0;let e=[0,0];this.gridNumber==1&&(e=[...p][0]),this.carRemote.gridPosition=[e.slice()[0],e.slice()[1]],this.carRemote.rotation=90},goal(){console.log("GOAL"),m.play("cheer"),this.goalDialog=!0,this.reachedGoal++},handleClick(e){const t=N(e.data.global,this.carRemote);let i=this.carRemote.rotation;for(;i<0;)i+=360;i=i%360,t&&t==n.FORWARD?(i==0?this.carRemote.gridPosition[1]--:i==90?this.carRemote.gridPosition[0]++:i==180?this.carRemote.gridPosition[1]++:i==270&&this.carRemote.gridPosition[0]--,this.legoHubStore.addCommand({cmd:n.FORWARD,rotationContext:this.carRemote.rotation})):t&&t==n.BACKWARD?(i==0?this.carRemote.gridPosition[1]++:i==90?this.carRemote.gridPosition[0]--:i==180?this.carRemote.gridPosition[1]--:i==270&&this.carRemote.gridPosition[0]++,this.legoHubStore.addCommand({cmd:n.BACKWARD,rotationContext:this.carRemote.rotation})):t&&t==n.LEFT?(this.carRemote.rotation-=90,this.legoHubStore.addCommand({cmd:n.LEFT,rotationContext:this.carRemote.rotation})):t&&t==n.RIGHT?(this.carRemote.rotation+=90,this.legoHubStore.addCommand({cmd:n.RIGHT,rotationContext:this.carRemote.rotation})):console.log("not detected");const h=this.carRemote.gridPosition;let s=[];this.gridNumber==1&&(s=p),s.some(a=>a[0]===h[0]&&a[1]===h[1])||this.crash()}}}),p=[[0,0],[1,0],[2,0],[2,1],[2,2],[3,2],[4,2]],W={class:"h-100 w-100 d-flex flex-row justify-center align-center"},Y={class:"h-100 w-100 flex-grow-1",ref:"gridContainer"},q={class:"flex-grow-0"},X=g("\xC5h nej! K\xF8re-Karl k\xF8rte galt!"),J=g("Luk"),Q=g("K\xF8re-Karl kom i m\xE5l!"),Z=g("Luk");function ee(e,t,i,h,s,a){return k(),T("div",W,[x("div",Y,null,512),x("div",q,[$(r(R,{color:"primary",icon:"mdi-chevron-right",size:"x-large",to:"/ghost-grid"},null,512),[[G,e.reachedGoal>0]])]),r(y,{modelValue:e.crashDialog,"onUpdate:modelValue":t[1]||(t[1]=l=>e.crashDialog=l)},{default:o(()=>[r(_,null,{default:o(()=>[r(C,null,{default:o(()=>[X]),_:1}),r(w,null,{default:o(()=>[r(A,{src:e.stopUrl},null,8,["src"])]),_:1}),r(v,null,{default:o(()=>[r(R,{color:"primary",block:"",onClick:t[0]||(t[0]=l=>e.crashDialog=!1)},{default:o(()=>[J]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(y,{modelValue:e.goalDialog,"onUpdate:modelValue":t[3]||(t[3]=l=>e.goalDialog=l)},{default:o(()=>[r(_,null,{default:o(()=>[r(C,null,{default:o(()=>[Q]),_:1}),r(w,null,{default:o(()=>[r(A,{src:e.goalUrl},null,8,["src"])]),_:1}),r(v,null,{default:o(()=>[r(R,{color:"primary",block:"",onClick:t[2]||(t[2]=l=>e.goalDialog=!1)},{default:o(()=>[Z]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var te=b(j,[["render",ee]]);const ie=V({name:"DirectGridView",components:{DirectGrid:te}});function re(e,t,i,h,s,a){const l=H("direct-grid");return k(),U(z,{class:"h-100"},{default:o(()=>[r(I,{class:"h-100"},{default:o(()=>[r(B,{class:"h-100 d-flex justify-center align-center",cols:"12"},{default:o(()=>[r(l)]),_:1})]),_:1})]),_:1})}var le=b(ie,[["render",re]]);export{le as default};

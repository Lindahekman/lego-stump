import{d,u as _,H as o,_ as m,o as p,c as f,a as n,w as g,v as C,b as i,V as w,r as A,e as v,f as r,g as $,h as k,i as H}from"./index.5d7d57f7.js";import{c,S as h,T as S,L as a,A as b,d as y}from"./remote-helpers.bf54a892.js";const V=d({name:"RemoteControl",setup(){const e=_();return e.sequentialMode=!1,e.clearCommands(),{carRemoteUrl:c,legoHubStore:e,HUB_COMMANDS:o}},data(){return{commandsIssued:0,pixiApp:null,carRemote:{sprite:new h(S.EMPTY),gridPosition:[0,0],rotation:0}}},mounted(){this.initPixi()},unmounted(){var e,t;(e=a.shared.resources.carRemote.texture)==null||e.destroy(!0),a.shared.reset(),this.carRemote.sprite.destroy(!0),(t=this.pixiApp)==null||t.destroy(!0)},methods:{tick(){const e=Math.min(this.pixiApp.renderer.width/this.carRemote.sprite.texture.width,this.pixiApp.renderer.height/this.carRemote.sprite.texture.height);this.carRemote.sprite.width=this.carRemote.sprite.texture.width*e,this.carRemote.sprite.height=this.carRemote.sprite.texture.height*e,this.carRemote.sprite.x=this.pixiApp.renderer.width/2,this.carRemote.sprite.y=this.pixiApp.renderer.height/2,this.carRemote.sprite.angle<this.carRemote.rotation?(this.carRemote.sprite.angle+=2,this.carRemote.sprite.angle>this.carRemote.rotation&&(this.carRemote.sprite.angle=this.carRemote.rotation)):this.carRemote.sprite.angle>this.carRemote.rotation&&(this.carRemote.sprite.angle-=2,this.carRemote.sprite.angle<this.carRemote.rotation&&(this.carRemote.sprite.angle=this.carRemote.rotation))},initPixi(){const e=this.$refs.remoteContainer;this.pixiApp=new b({resizeTo:e,backgroundAlpha:0}),e.appendChild(this.pixiApp.view),a.shared.add("carRemote",c).load((t,s)=>{this.carRemote.sprite=new h(s.carRemote.texture),this.carRemote.sprite.anchor.set(.5),this.carRemote.sprite.interactive=!0,this.carRemote.sprite.on("mousedown",this.handleClick),this.carRemote.sprite.on("touchstart",this.handleClick),this.pixiApp.stage.addChild(this.carRemote.sprite),this.pixiApp.ticker.add(this.tick)})},handleClick(e){const t=y(e.data.global,this.carRemote);t&&t==o.FORWARD?(this.commandsIssued++,this.legoHubStore.addCommand({cmd:o.FORWARD,rotationContext:this.carRemote.rotation})):t&&t==o.BACKWARD?(this.commandsIssued++,this.legoHubStore.addCommand({cmd:o.BACKWARD,rotationContext:this.carRemote.rotation})):t&&t==o.LEFT?(this.commandsIssued++,this.carRemote.rotation-=90,this.legoHubStore.addCommand({cmd:o.LEFT,rotationContext:this.carRemote.rotation})):t&&t==o.RIGHT?(this.commandsIssued++,this.carRemote.rotation+=90,this.legoHubStore.addCommand({cmd:o.RIGHT,rotationContext:this.carRemote.rotation})):console.log("not detected")}}}),B={class:"h-100 w-100 d-flex flex-row justify-center align-center"},I={class:"h-100 flex-grow-1",ref:"remoteContainer"},T={class:"flex-grow-0"};function D(e,t,s,l,R,u){return p(),f("div",B,[n("div",I,null,512),n("div",T,[g(i(w,{color:"primary",icon:"mdi-chevron-right",size:"x-large",to:"/direct-grid"},null,512),[[C,e.commandsIssued>2]])])])}var L=m(V,[["render",D]]);const M=d({name:"RemoteView",components:{RemoteControl:L}});function E(e,t,s,l,R,u){const x=A("remote-control");return p(),v($,{class:"h-100"},{default:r(()=>[i(k,{class:"h-100"},{default:r(()=>[i(H,{class:"h-100 d-flex justify-center align-center",cols:"12"},{default:r(()=>[i(x)]),_:1})]),_:1})]),_:1})}var W=m(M,[["render",E]]);export{W as default};
